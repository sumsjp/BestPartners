大家好，这里是最佳拍档，我是大飞
俗话说，物以稀为贵
不可或缺的有限资源
任何时候都是有着不菲价值的
对于云计算巨头亚马逊来说
也是一样
上个月
亚马逊的首席布道师Jeff Barr发布了一篇博客
对外宣布即将对公共IPv4地址
实行新的收费政策
所有的公共IPv4地址
会按照每个IP每小时0.005美元的价格收费
而且无论是否附加到服务中
都要收费
执行时间为2024年2月1日起
我们今天就来聊聊IPv4耗尽这个事
所谓IPv4
也就是互联网通信协议第四版
是网际协议开发过程中的第四个修订版本
也是该协议第一个被广泛部署的版本
这个地址是一个用来识别互联网设备的32位编号
在根服务器方面
全世界IPv4根服务器只有13台
1个为主根服务器在美国
其余12个均为辅根服务器
其中9个在美国
欧洲2个
位于英国和瑞典，亚洲1个位于日本
电影《流浪地球2》中位于北京的根服务器
应该是指的IPv6的根服务器
2016年，中国加入雪人计划
这个计划是要在美国、日本、印度、俄罗斯、德国、法国等全球16个国家
完成25台IPv6根服务器架设
其中1台主根和3台辅根部署在中国
近二十年来
随着智能手机、个人电脑、物联网设备的爆发性增长
已经消耗了近43亿个IPv4的地址
这也使得在2019年
负责英国、欧洲、中东和部分中亚地区互联网资源分配的
欧洲网络协调中心（RIPE NCC）无奈宣布
截至2019年11月25日
所有的IPv4地址会消耗殆尽
也就是说，早在四年前
全球42亿个IPv4地址早已经分完了
这也意味着没有更多的IPv4地址
可以分配给ISP和其他大型网络基础设施提供商了
不过，需要注意的是
IPv4地址虽然已分配完毕
但是并不代表行业内完全不能再用IPv4地址
对于想要继续使用公共IPv4地址的用户而言
他们主要靠回收和未使用地址段的释放
才能用上IPv4
其中这些地址要么来自倒闭的组织
要么来自于那些已经迁移到IPv6后
不再需要的地址
随着IPv4日益稀缺
获取IPv4地址的过程也变得越来越复杂
成本自然也就涨起来了
根据亚马逊之前透露的信息
在过去五年中
由于难以获得公共IPv4地址
单个地址的获取成本上涨了300%以上
即使在云计算巨头亚马逊看来
这也是一笔不菲的支出
为了缩减成本，AWS才做下此番决定
宣布将从明年开始对IPv4公网地址收费
Jeff Barr在公告中写道
这一变化反映了我们自身的成本
同时也是为了鼓励大家在使用公共IPv4地址时更加节俭
并考虑加快采用IPv6作为现代化和保护措施
从2024年2月1日开始
亚马逊将对所有公共IPv4地址
按照每小时每个IP地址0.005美元的政策
进行收费
同时
这些收费将适用于所有的AWS服务
包括EC2、关系数据库服务（RDS）、Elastic Kubernetes Service (EKS)，
并且将适用于所有的AWS的区域
包括商业性服务、AWS中国和GovCloud
乍一看
0.005美元似乎是一笔很小的费用
但是注意，这是按小时的收费
而且是账户中的每个IPv4地址
无论它是否附加到你的AWS服务上
所以按照亚马逊的这个收费标准
我们可以快速计算一下
对于一个IPv4地址，按照1天24个小时
一年365天计算
新的收费金额将为每年43.80美元
按照今天外汇人民币对美元7.29的汇率
就是不到320块人民币
如果你使用了多个公共IPv4地址
一年累计下来也是一笔不小的开支
不过，亚马逊还指出
客户如果使用亚马逊的BYOIP服务
将自己拥有的IP地址带入AWS
则无需支付费用
也就是你可以转入已有的IPv4地址
另外
AWS 为EC2服务器提供了一个免费的套餐
包括在前12个月
每月750小时的公共IPv4地址使用时间
这个也是从2024年2月1日开始生效
为了帮助用户审查对公共IPv4地址的使用情况
亚马逊还推出了一个新的公共IP洞察工具
这是一款免费工具
能够引导用户查看、排序、过滤目前使用的公共IPv4地址
并且了解每个地址的更多信息
它还可以帮助用户了解可以在哪些方面最大限度地减少新费用的影响
除了IPv4地址的成本激增以外
亚马逊这次推出收费政策的另一层原因
其实也是想要推动IPv6地址的应用
作为取代IPv4的新版本
距离IPv6正式推出已经有十多年的时间了
大飞我十年前在外企的时候
就对系统做过这方面的改造
当时也说IPv4要用尽
因为IPv4只有32位的寻址
所以仅限用于43亿台设备
而IPv6采用了128位寻址
可以提供2的128次方
大约3.4乘以10的38次方个地址
应该说，完全足够任何设备来用了
同时
IPv6协议不仅扩展了可用地址的数量
还可以更有效地处理数据包、提高性能和安全性等等
不过
由于IPv4和IPv6的标头有很大不同
因此这两种协议无法进行互相操作
很多公司也都认为没有必要改变
尤其是从旧的标准向新的标准迁移
可能会涉及到遗留系统升级、开发成本等等因素
所以这也导致IPv6采用的速度一直很缓慢
根据The Register的报道
尽管全球未分配的IPv4地址已经在2019年正式耗尽
但是根据欧洲地区互联网注册机构RIPE NCC去年公布的数据显示
IPv4路由表中的条目数量
仍然是IPv6的六倍
而且它还预测
全球可能需要5-10年的时间
才能够真正放弃IPv4地址空间
在Google 2018年6月的统计中
仅有24个国家的IPv6流量超过15%，
其中包括美国、加拿大、芬兰、比利时、印度和巴西等
而据 Techradar的数据
美国和印度的IPv6 普及率已超过50%，
但挪威、丹麦、瑞典等发达经济体低于15%，
反而是巴西、泰国、墨西哥等新兴经济体普及率更高
目前全球前1000个网站中能通过IPv6 访问的
只有25%-30%，
基本上都是Google、Netflix等大网站
苹果的App Store从2016年起要求应用兼容IPv6
国内用户比较熟悉的大概就是支付宝了
腾讯也在21年年初宣布旗下的核心产品已全面支持IPv6
那么为什么这么长时间
大家还没有都换成IPv6呢？
我觉得主要有两点原因吧
一个是前面我们说过的兼容性问题
我们都知道，兼容有两种方式
一个是向前兼容，一个是向后兼容
如果IPv6和IPv4是向前兼容
那么处理IPv4协议的硬件设备
可以不用更新就能处理IPv6数据
这样一来，硬件设备无需更新
成本大大降低
另外一种是向后兼容
即使用IPv6的硬件设备
能同时处理IPv4的数据包
这种兼容方式，虽然要升级硬件设备
但至少IPv6协议的推进
也不会像现在这么复杂
直接更新设备就行了
但是，IPv6的设计者
既没有考虑向前兼容
也没有考虑向后兼容
以至于只能通过双协议栈、隧道技术、NAT64等方式
来实现协议的过渡，因此
IPv6的推进工作成本就增加了不少
其次是由于NAT技术的存在，简单来说
它能够在IP数据包通过路由器时
修改其中的网络地址
把内网地址换成公网地址
变相缓解了IPv4枯竭所带来的问题
但是这种方式出去容易，进来难
而且协议本身也有局限性
很多服务都会受到限制
同时它也违反了主机之间应当直接对话的原则
也违反了网络分层结构的设计原则
所以使用IPv6替代IPv4，才是正途
最后
随着这次AWS开始向公共IPv4地址增加收费
相信其他云计算厂商也会很快跟进
也许是促使和推动大家更换IPv6地址的一个契机
好了，本期视频内容就到这里
感谢大家的观看，我们下期再见
