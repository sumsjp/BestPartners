大家好，这里是最佳拍档，我是大飞
我们都知道，随着AI时代的到来
数据中心行业也在快速的发展
可是你知道吗？
数据中心里的CPU往往不能百分之百的投入使用
总会有时候产生一些不必要的浪费
比方说，大飞我买了个100核的CPU
但是实际使用的时候
就只能用到90个核
那其他10个核去哪里了？
答案就是
去跑了一堆数据中心的其他软件
比如安全、存储、管理系统等等
这额外10个核的开销部分
就造成了一些浪费
相当于我们花了100块钱
但是只有90块钱被用在了计算上
为了应对这部分的损耗
就需要一个专门来干脏活累活的角色
也就是我们今天视频要介绍的主角
DPU
英文全称叫做 Data Processing Unit
也就是数据处理器
之前我们曾经在左江骗局那期视频中
提到过DPU
那么，究竟什么是DPU？
我们为什么这么需要它？
它的发展历史又是怎样的？
它究竟是当下的权宜之计
还是科技浪潮中必不可少的一环？
今天大飞就来带大家深入的了解一下
在传统的冯·诺依曼架构体系中
网络一般只是起到数据传输的作用
计算都是以CPU或者GPU为中心
而当GPT和BERT等大型的、复杂的模型
将它们的工作负载分配到数量众多的GPU上
进行并行计算的时候
将会产生大量的突发梯度数据传输
从而容易导致网络拥塞
这属于传统冯·诺依曼架构的一个天然弊端
在如今算力极大提升的AI时代
单纯的提升网络速度和带宽
都无法彻底解决这个问题
那么如何在这个限制下
继续提升数据中心的网络性能呢？
这个时候，就需要DPU出现了
简单来说
就是DPU让网络不仅能够提供数据传输的功能
还能承担起一些数据处理的计算
通过这种新的架构方式
可以将一些基础的工作负载分配到DPU上
从而解决网络传输中的瓶颈问题和丢包问题
这种方式比单纯的提高传输速度和加大带宽
要有效10倍以上
这个设计也有点像人类社会中的分工合作
为了给大家更清晰地说明一下
我们来举个例子
假设科技研究就和经营餐馆一样
以前人手比较少的时候
老板一个人承担采买、洗切、配菜、烹调、传菜和收银等全部工作
这就像CPU一样
不仅要进行数学和逻辑运算
还要负责管理外部设备
在不同的时间执行不同的任务
并且在每一项任务完成之后
还要进行其他任务的切换
从而满足不同应用程序的执行需要
但是随着要服务的就餐客户
数量越来越多
就需要将不同的任务分派给不同的人员来分担
招几个店员来负责采买、洗切、配菜
保障厨师的烹调备料；
有一些厨师同时进行烹调
以此来提升菜品的制作效率
还有好几位服务员负责提供服务和传菜
保证每一桌客人的服务质量
这个时候
老板就可以只负责收银和管理了
这样一来
大家之间的分工合作井井有条
效率自然会有所提高
我们再说回DPU
其实DPU这个概念出现的很晚
2020年
英伟达正式推出了两款 DPU 产品
分别是BlueField-2 DPU和BlueField-2X DPU
不过在有DPU这个概念之前
人们就已经开始使用有类似功能的产品了
只是当时还不叫DPU
比方说智能网卡（Smart NIC）
这是由以色列的Mellanox公司提出的概念
智能网卡除了能完成标准网卡的网络传输功能之外
还提供了内置的可编程、可配置的硬件加速引擎
在提升应用性能的同时
大幅降低了CPU在通信中的消耗
同时
我们还可以将一些相关任务转移到智能网卡上
将原本用来处理这些任务的CPU解放出来
确保了服务器CPU可以为应用提供最大的处理能力
这个思路其实与DPU没有什么本质区别
也正是因为看到了智能网卡在商业上的巨大价值
2019年3月
英伟达花费了69亿美元收购了Mellanox
并且在2020年推出了DPU产品，从此
DPU这个概念正式进入了公众的视野
那除了上面所说的
能够减少CPU的不必要消耗以外
DPU还有什么其他的用处么？
当然还是有的
抛开性能方面的提升不谈
DPU也引发了安全和存储方面的改变
首先，DPU的出现
相当于为每个服务器配备了一台"计算机前的计算机"，
来提供独立、安全的基础设施服务
并且可以与服务器的应用域安全隔离
为企业提供零信任保护
如果主机遭受入侵
安全控制代理与被入侵主机之间的DPU隔离层
可防止攻击被扩散到整个数据中心
其次，通过DPU技术
存储厂商可以实现真正的"算存分离"，
进而使得存储行业的各种革新算法
比如DAS、SCALE-UP、SCALE-OUT以及超融合
可以在DPU架构中
独立于服务器操作系统进行部署和实现
总体来说
面对如今数据处理需求的增长
CPU的算力已经达到瓶颈
虽然GPU的出现解决了CPU的算力问题
但是数据中心如今面临的瓶颈
已经逐渐转向基础设施任务
比如数据存储、数据验证、网络安全等
而DPU的出现
恰好满足了这种基础设施的需求
不仅提供了符合行业标准、高性能、软件可编程的多核CPU
以及高性能的网络接口
甚至丰富、灵活的可编程加速引擎
可以执行AI和机器学习、安全、存储和虚拟化等任务
因此，基于DPU构建的强大基础设施
使得上层的CPU和GPU可以更好地完成计算任务
满足新时代的算力需求
那么目前市面上有哪些DPU产品呢？
首先毋庸置疑的是
英伟达目前在DPU领域处于全球领先地位
正如刚才所说，2020 年的上半年
英伟达推出了BlueField-2 DPU
并且将它定义为继CPU和GPU之后的“第三颗主力芯片”，
正式拉开DPU发展的序幕
紧接着2021年4月
英伟达又对外发布了新一代的BlueField-3 DPU
这款DPU是首款针对AI和加速计算而设计的DPU
可以更好的实现数据中心基础设施工作负载的卸载、加速和隔离
从而释放宝贵的CPU资源
来运行最为关键的业务应用
作为业内首款400G以太网和NDR InfiniBand DPU
BlueField-3具有非常出色的网络性能
从加速AI到混合云和高性能计算
再到5G无线网络
可以说BlueField-3 DPU重新定义、甚至开创了许多的可能性
这里我们稍微展开讲一下BlueField-3的架构和技术特点
BlueField的架构本质上将网卡子系统
与可编程数据路径、用于加密、压缩等的硬件加速器子系统
以及用于控制的ARM处理器子系统
融合在了一起
在BlueField-3中
数据路径加速分组DPA
包括16个处理器核
可以并行处理256个线程的任务
我们再从网络业务、安全业务、和存储业务几个方面
分别介绍一下BlueField-3的重要技术特性
在网络业务中
BlueField-3专门针对RDMA、连接跟踪（Connection Tracking）、ASAP2等这些网络通信技术
做了进一步的加强，特别是时间精度
可以在数据中心和边缘之间
做非常及时的时钟同步
其中
RDMA技术可以直接在内存之间交换数据
不仅能够获得较好的扩展性
提升运行性能，还可以可卸载CPU算力
它的优势还包括零拷贝、内核旁路、不需要CPU干预、基于事务的消息
以及原生支持分散/聚合操作
在安全业务上
BlueField-3可以实现从IP层、传输层以及到MAC层的
每秒400Gb全线速在线加解密
以及每秒50Gb的深度包检测
同时
BlueField-3还可以支持IPSec和TLS协议
在通信加解密方面释放大量的CPU算力
在存储业务中
BlueField-3可以做到对块存储（Block Storage）、文件存储（File Storage）、对象存储（Object Storage)或者NVMe存储（NVMe Storage）的仿真
还可以对数据落盘时加解密的操作进行硬件卸载
甚至是将各种签名操作分流到DPU上
而基于软件定义的网络加速处理BlueField SNAP技术
允许用户访问远程的NVMe存储
就像访问本地存储一样
实现了远程存储的所有效率和管理优点
同时具有本地存储的简单性
不过，在发布了BlueField-3 DPU之后
英伟达仍然没有停下探索的脚步
英伟达发现
随着大语言模型的出现和流行
如何提升GPU集群的分布式计算性能和效率、提高GPU集群的横向扩展能力
实现在生成式AI云上的业务性能隔离
成为了所有大模型厂商和AI服务供应商所共同关注的问题
为此，在2023年底
NVIDIA推出了BlueField-3 SuperNIC
它源于BlueField DPU
采用了与DPU相同的架构
但是有别于DPU
DPU专注于对基础设施的操作
是对南北向流量进行加速和优化
负责处理软件定义、网络、存储和网络安全等任务
而BlueField SuperNIC则借鉴了InfiniBand网络上的动态路由、拥塞控制和性能隔离等技术
又兼容了以太网标准在云上的便利性
从而满足了超大规模的生成式AI云平台
对于性能、扩展性和多租户方面的需求
除了英伟达以外
目前英特尔和Marvell也是这方面的产业先驱
大多数的DPU方案都是从基本的网络控制器开始
逐步扩展到SoC
所以英特尔的产品采取了处理器配合FPGA
外加加速引擎的方式
而Marvell则采取了使用最新处理器内核配合加速引擎的方式
英伟达则采取的是处理器配合ASIC
外加加速引擎的方式
这三种方式也代表着DPU产业未来主流的三种发展方向
从英伟达等公司现有的技术发展趋势可以看出来
未来的技术发展趋势将会是高度集成化的片上数据中心的模式（Data Center Infrastructure on a chip）
即一个GPU、CPU、DPU共存的时代
3U一体的统一计算单元架构将会让管理程序、调度程序都会变得非常容易
通过CPU、GPU、DPU之间的协调计算
可以在数据中心和边缘端都可以达到高性能与高安全性
总之
DPU就是致力于解决"网络协议处理、数据安全、算法加速"等问题
而这些问题一直存在着“CPU做不好
GPU做不了”的特点
这就奠定了DPU在未来的数据分工合作中
必然会占据一席之地
只要科技还没有什么新的超级突破
在未来很长一段时间里
3U一体将会是所有尖端研究的必备框架
好了，以上就是对DPU的简单介绍了
可以看到，随着科技的不断进步
各个芯片部件的分工合作
也变得越来越常见
就像人类社会越来越发展
专业分工的人员也越来越多
而通晓所有科学的全才
则是越来越少
以往在科幻片中经常能见到的的
“一个芯片就可以解决任何问题”的幻想
或许永远都不会在现实中实现了
不过
这也并不需要我们担心或者纠结
不如说，这正说明我们的科技积累
已经发展到了一个新的层次
哪怕是CPU也到了需要分工细化的程度
未来
或许我们会看到更多、更新形式的分工合作
不过当下一次科技大爆炸之后
是否又会摒弃分工合作
重新恢复到高度集成化呢？
欢迎大家在评论区留言，感谢观看
我们下期再见
