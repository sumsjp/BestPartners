好的，我整理後的文稿如下，我盡可能保留了原文的口語風格，並進行了潤飾和結構調整，使其更易於閱讀和理解：

**主題：本地安裝 Mini-GPT4 教程**

**開場白:**

大家好，這裡是最佳拍檔，我是小郭。前段時間大飛分享了一期 Mini-GPT4 的介紹，很多朋友問到安裝相關的問題。今天就給大家分享一下如何在本地安裝 Mini-GPT4。

**安裝概述:**

Mini-GPT4 的安裝其實並不複雜，就像官網介紹的，只需要三步。但是如果國內的小伙伴來安裝的話，情況會稍微複雜一些，其中還有一些小坑。不過沒關係，我都已經幫大家踩過了！話不多說，咱們開始今天的内容。

**一、 硬件環境:**

*   **顯卡:** Mini-GPT4 的運行需要 NVIDIA 的顯卡，所以使用蘋果晶片電腦的朋友需要找其他機器來運行。
*   **顯存:** Mini-GPT4 使用的 Vicuna 模型需要比較大的顯存。
    *   13B 模型：大約需要 23GB GPU 顯存。
    *   7B 模型：大約需要 11.5GB-12GB 顯存。
*   **儲存空間:** 下載模型參數文件和 Python 依賴包也需要比較大的儲存空間。整個安裝下來大概需要 100GB 的空間，建議系統的可用空間有 150GB 以上。
*   **CPU 和内存:** 對於 CPU 和記憶體倒是沒有提到具體的要求。咱們這裡使用的伺服器是至強 5218，一個 64 核 2.3GHz 的處理器，記憶體是 256GB。
*   **作業系統:** Linux 和 Windows 應該都可以，推薦使用 Ubuntu。咱們這裡使用的作業系統是 Ubuntu 22.04。
*   **軟件:** 只需要用到 Git 和 Git-LFS，還有你常用的文字編輯器就夠了。不需要單獨安裝 Python，因為安裝 Conda 的時候，它會自帶一個 Python。當然，如果你的系統已經安裝了也無所謂。
*   **終端復用軟件:** 推薦大家使用終端的復用軟件，這樣可以在一個終端里同時進行多個操作。如果你通过 SSH 連接到遠程終端，在 SSH 斷開的時候，終端復用軟件還可以保持之前運行的程式繼續運行，這在網絡不穩定的情況下非常有用。

**二、 安裝文件準備:**

我把所有的文件都放到了 `/opt/minigpt4` 之下。接下來使用的一些命令和配置中的內容也都是基於這個目錄的。實際安裝的時候，根據實際情況進行相應的調整。

*   **Conda 安裝文件:** 用於創建虛擬環境。
*   **`env` 目錄:** 創建的虛擬環境，所有的依賴包都會安裝到這個目錄下。
*   **Mini-GPT4 源码:**  Mini-GPT4 的原始程式碼。
*   **需要手動下載的文件:** 原本在程式碼裡是運行時從網上下載的兩個文件，如果網路不穩定，建議提前用瀏覽器下載，然後修改原始碼，讓程式讀取預先下載好的文件，以避免失敗。
*   **LLAMA 模型 (llama-7b):** 注意其授權條款，不能再次發行。正常流程需要填寫申請表，審核通過後才能使用。實際上，可以在通過審核前通過 Git 直接下載。
*   **Vicuna 差异模型 (vicuna-7b-delta-v0):**  LLAMA 和 Vicuna 之間的差異模型。
*   **Vicuna 目錄:** 把 LLAMA 模型和 Vicuna 差異模型合併之後的產出物。

這些文件加起來大概是 99GB，運行時可能還會寫入一些文件，建議保留 100-150GB 的空間。

**三、 安裝步驟 (共五步):**

1.  **下載依賴的文件**
2.  **創建虛擬環境**
3.  **合併模型文件**
4.  **修改配置**
5.  **啟動程式**

其中前兩步最關鍵也最耗時，因為需要從網上下載大量的文件（模型文件有 20 多 GB）。

**四、 下載文件的方式:**

*   **Git 下載:** 適用於原始碼庫或 Git-LFS 託管的文件。
*   **瀏覽器下載:** 適用於 Google 網盤上的文件。可以使用瀏覽器、curl 或 wget 下載。

**注意:** 下載模型文件之前，要先運行 `git lfs install` 命令，確保它已經正確初始化。

**五、 創建虛擬環境:**

1.  **安裝 Conda:**
    *   **Anaconda:** 自帶約 1,500 個依賴包，安装包及安装所需磁盘空间也较大（約 3GB）。
    *   **Miniconda:** 體積小（只有幾十 MB），不帶預製包，可以根據自己的情況選擇。這裡使用 Miniconda，大概只有 70MB。
    *   下載後直接運行 `.sh` 文件進行安裝，根據提示一步一步操作即可。
    *   如果文件沒有可執行權限，可以使用 `sh Miniconda3-py310_23.3.1-0-Linux-x86_64.sh` 或 `chmod +x Miniconda3-py310_23.3.1-0-Linux-x86_64.sh` 後再運行。
    *   安装最後會提示是否需要初始化终端，選擇“是”。
    *   重新登錄後，命令提示符前面會多一個 `(base)`，表示 Conda 安裝成功。可以使用 `conda --version` 驗證。
    *   **Windows 使用者:** 用 exe 安裝 Conda 時，儘量選擇只為我自己安裝，否則可能會因為嘗試寫入系統文件導致安裝失敗。
2.  **設定 Conda 镜像源:**
    *   將镜像源信息寫入配置文件 (`~/.condarc`)。
    *   運行 `conda clean -i` 清理之前的緩存。
3.  **設定 Pip 镜像源:** 運行相關命令設定即可。
4.  **创建虚拟环境:**
    *   切換到 Mini-GPT4 的原始碼目錄。
    *   使用 `environment.yml` 文件創建虛擬環境。
    *   **创建方式：**
        *   **官方方式:** `conda env create -f environment.yml` (环境目录在用户目录下)
        *   **指定位置:** `conda env create -n <環境名稱> -f environment.yml -p <指定目录>`
    *   **激活虚拟环境：**
        *   **官方方式:** `conda activate minigpt4`
        *   **指定位置:** `conda activate <指定目录>`
    *   創建成功後，按照提示的命令激活新環境，並使用 `conda deactivate` 返回基礎環境。

**重要:** 虛擬環境創建好之後，一定要激活這個環境。接下來所有的操作都是在新的環境下運行的，不要在 `base` 環境下運行。

**六、 合併模型參數文件:**

1.  **安裝 fast-chat 依赖包:** 運行 `pip install "fschat[model_worker,webui]"`
    *   **Windows 使用者:** 可能會遇到文件名過長導致安裝失敗的問題，可以將 `TMP` 目錄修改為較短的目錄。
2.  **驗證安装:** 運行 `pip show fschat`，如果版本是 0.1.10，則安裝成功。
3.  **確認模型文件下载完成:** 在 LLAMA 模型目录中运行 `git pull`，如果提示 "Already up to date"，表示下載完成。
4.  **运行合并命令：** （命令太長就不讀了）
    *   `--base`: LLAMA 模型目錄的絕對路徑。
    *   `--target`: 最終生成的模型文件目錄。
    *   `--delta`: Vicuna 差异模型目錄。

**七、 修改配置文件:**

1.  **修改 `minigpt4/configs/models/minigpt4.yml`:**
    *   找到第 16 行，將 `pretrained` 配置成合併模型時使用的 `--target` 參數的目錄。
2.  **修改 `eval_configs/minigpt4_eval.yaml`:**
    *   找到第 11 行的 `checkpoint`，配置成下载的 Mini-GPT4 7B 的 checkpoint 文件 (是一個文件，不要配置成目錄)。

**八、 修改源码（可选，用于使用本地预先下载的文件）:**

1.  **修改 `minigpt4/models/mini_gpt4.py`:**
    *   修改第 27 行，將原本的 HTTPS 地址改成提前下載好的文件的絕對路徑。
2.  **修改 `minigpt4/modoles/eva_vit.py`:**
    *   將 429 行到 432 行註釋掉或刪除，並將原本的 HTTPS 地址改成提前下載好的 `eva_vit_g.pth` 文件的絕對路徑。

**九、 啟動程式:**

運行啟動命令。第一次啟動可能需要下載一些依賴包，但之後就不需要了。

**十、 局域网访问配置:**

默認情況下，只能通過 `127.0.0.1` 訪問。如果想通過局域網地址訪問，需要修改 `demo.py` 文件：

*   找到最後一行，新增 `server_name` 參數，並將其設置為 `0.0.0.0`。
*   如果不想創建公網訪問地址，可以将 `share` 设置为 `False`。

**十一、 虚拟环境问题:**

*   如果退出登錄後再次登錄，環境會回到 `base`，需要重新激活虛擬環境。
*   如果沒有激活虛擬環境，程式會提示找不到模組。

**十二、 显卡驱动问题:**

一定要保證顯卡的驅動是正確安裝的。可以使用 `nvidia-smi` 命令查看顯卡的狀態。

**結尾:**

好了，以上就是今天的所有内容了。感謝大家的觀看！如果喜歡我們的頻道，歡迎大家關注。謝謝大家！

**总结:**

我盡可能保留了原文的口語風格，並將內容重新整理為更結構化的步驟，使讀者更容易理解和跟隨。希望能幫助到您！

[model=gemini-2.0-flash,0]
