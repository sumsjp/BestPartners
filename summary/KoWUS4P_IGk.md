好的，我將盡力以清晰、簡潔的方式整理這段文稿。

**整理後的文稿：**

**標題：Twitter（推特）推薦系統架構解析**

**簡介：** 本影片講解 Twitter 開源的推薦系統原始碼，涵蓋系統架構、精排模型和圖模型預訓練表徵。

**內容概要：**

1.  **問題定義：**
    *   輸入：由推文、用戶交互行為等構成的超大規模異構圖 (Twitter network)。
    *   輸出：預測用戶與推文/其他用戶交互的概率，從而進行推文/用戶推薦。
    *   重點：社交圖 (social graph) 挖掘，包括圖特徵、圖預訓練、圖召回模型等。

2.  **整體架構：**
    *   **數據層：** 包含社交圖 (用戶、推文、互動等)、用戶交互行為、用戶畫像數據等。 這是推特的核心資產。
    *   **特徵工程：** 關注社交圖的預訓練、聚類、社群發現等。 圖預訓練得到的向量可用於向量召回、精排特徵等。
    *   **推薦系統服務 (Home Mixer)：** 基於 Scala 框架，包含：
        *   **召回 (Candidate Sources)：** 從不同推薦源獲取最佳推文 (類似於推薦系統的召回階段)。核心召回方式是圖召回。
        *   **粗排與精排：** 使用機器學習模型 (Light Ranker 和 Heavy Ranker) 對推文進行打分排序 (分別類比推薦系統的粗排和精排階段)。
        *   **重排與混排：** 運用啟發式規則，例如過濾屏蔽用戶的推文、NSFW 內容、已看過的推文，保證作者多樣性，以及廣告、推文和作者混排等。

3.  **召回 (Candidate Sources)：**
    *   輸入：推文候選池 (億萬級別)。
    *   輸出：
        *   **In-network：** 用戶關注的推文 (約佔50%)，主要通過 Earlybird 搜索引擎檢索，再經過 Light Ranker 粗排。
        *   **Out-of-network：** 用戶未關注的推文 (約佔50%)，通過兩種方法：
            *   **UserTweetEntityGraph (UTEG)：** 協同過濾，分析用戶關注/相似興趣用戶的行為，預測用戶感興趣的推文 (約佔15%)。使用 GraphJet 圖引擎構建和遊走動態圖。Light Ranker 粗排。
            *   **Embedding Spaces (嵌入表徵學習)：** 訓練用戶和推文的表徵向量，計算相似性。 包括稀疏嵌入 (SimClusters，基於社群發現的異構表徵模型) 和稠密嵌入 (TwHIN，基於圖學習的預訓練)。
    *   **CR-Mixer：** 協調層，代理執行 Out-of-Network 的多路召回，並調用底層計算服務 (源信號抽取、召回結果生成、過濾和粗排)。
    *   **推人服務 (Following Recommendation Service, FRS)：** 推薦作者，流程與推文推薦類似，包括召回、排序、過濾、推薦理由等。 排序主要預測關注概率和正向交互概率的加權融合。

4.  **粗排 (Light Ranker)：**
    *   本質：引擎側召回通道的海選粗排。
    *   模型：較舊的邏輯回歸 (LR) 模型，預測用戶與推文交互的概率。 特徵包括用戶側特徵 (tweepcred 模型預估聲譽)、推文特徵 (文本質量、轉發、回覆等) 和上下文特徵 (用戶語言等)。
    *   **RealGraph：** 用於 in-network 召回的粗排模型，預測用戶與用戶交互的概率，基於 RealGraph (帶權重的同構圖) 以及邊的特徵。

5.  **精排 (Heavy Ranker)：**
    *   模型：Parallel MaskNet (新浪微博在 DLP-KDD 2021 發表)，多目標模型，用 48M 參數的神經網路實現。
    *   目標：優化點讚、轉發、回覆等目標，考慮數千個特徵，輸出 10 個 level 的分數，代表交互概率。
    *   融合排序：簡單的加權求和。

6.  **重排與混排：**
    *   **重排：** 啟發式規則導向，主要目的為過濾 (屏蔽推文、作者)、保證作者多樣性、內容平衡性、基於反饋的疲勞內容干預、二跳人脈過濾 (social proof)、推文/回覆上下文展示和更新檢測。
    *   **混排 (Homepage Mixer)：** 負責主頁上的混排，包括推文、廣告、關注的作者、Onboarding prompts 等。

7.  **基礎設施服務：**
    *   **Navi：** 用 Rust 編寫的高性能機器學習模型 Serving 服務。
    *   **Product-mixer：** 用於構建內容 Feed 的軟體框架。
    *   **TWML (Twitter Machine Learning)：** 基於 TF-1 的機器學習訓練框架，主要用於訓練粗排的 Earlybird Light Ranker。

8.  **總結：** Twitter 開源核心演算法是一個大膽的舉措，提供了一個典型的大型推薦系統案例。

**關鍵詞：** Twitter, 推薦系統, 開源, 算法, 架構, 召回, 粗排, 精排, 特徵工程, 圖模型, Embedding, 社交圖, Scala, Machine Learning.

**說明：**

*   我使用了更明確的標題和副標題，以便於理解文章的結構。
*   我簡化了一些術語，並添加了說明，以便不熟悉技術的人也能理解。
*   我使用了關鍵詞，以便於搜索和索引。
*   我盡可能地保留了原稿的重點和信息。

希望以上整理對您有所幫助！

[model=gemini-2.0-flash,0]
